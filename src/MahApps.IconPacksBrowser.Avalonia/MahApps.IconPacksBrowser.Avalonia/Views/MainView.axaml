<UserControl x:Class="MahApps.IconPacksBrowser.Avalonia.Views.MainView"
             xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:MahApps.IconPacksBrowser.Avalonia.ViewModels"
             xmlns:fa="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
             xmlns:helper="clr-namespace:MahApps.IconPacksBrowser.Avalonia.Helper"
             xmlns:iconPacks="https://github.com/MahApps/IconPacks.Avalonia"
             xmlns:controls="clr-namespace:MahApps.IconPacksBrowser.Avalonia.Controls"
             xmlns:converters="clr-namespace:MahApps.IconPacksBrowser.Avalonia.Converters"
             xmlns:windowing="clr-namespace:FluentAvalonia.UI.Windowing;assembly=FluentAvalonia"
             xmlns:views="clr-namespace:MahApps.IconPacksBrowser.Avalonia.Views"
             d:DesignWidth="800"
             d:DesignHeight="450"
             helper:DialogManager.Register="{Binding}"
             x:DataType="vm:MainViewModel"
             mc:Ignorable="d">
    <Design.DataContext>
        <!--
            This only sets the DataContext for the previewer in an IDE,
            to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs)
        -->
        <vm:MainViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        <Border Grid.Row="0"
                Height="48"
                BorderBrush="{DynamicResource AccentFillColorDefaultBrush}"
                BorderThickness="0,0,0,3"
                Margin="0,0,0,1"
                DockPanel.Dock="Top">
            <DockPanel LastChildFill="True">
                <!-- Placeholder for WindowButtons -->
                <Border x:Name="WindowButtonsPlaceHolder" 
                        DockPanel.Dock="Right" 
                        Width="0" />
                <TextBox x:Name="FilterTextBox"
                         MinWidth="400"
                         Margin="5"
                         VerticalContentAlignment="Center"
                         Watermark="Filter by... (Ctrl + F)"
                         BorderBrush="{DynamicResource SurfaceStrokeColorDefaultBrush}"
                         CornerRadius="{Binding $self.Bounds, Converter={x:Static converters:BoundsToCornerRadiusConverter.Instance}}"
                         BorderThickness="1"
                         DockPanel.Dock="Right"
                         Text="{Binding FilterText}">
                    <TextBox.InnerLeftContent>
                        <iconPacks:PackIconBootstrapIcons Kind="Search" 
                                                          VerticalAlignment="Center"
                                                          Height="14"
                                                          Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                                          Margin="10,0,0,0"/>
                    </TextBox.InnerLeftContent>
                    <ToolTip.Tip>
                        <StackPanel Spacing="5">
                            <TextBlock Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                       FontWeight="Bold"
                                       Text="Advanced filtering:" />
                            <TextBlock TextWrapping="NoWrap">
                                <Run Text="Use these chars to match all substrings: &#x09;" />
                                <Run FontFamily="Courier New" Text="'&amp;' '+' ',' ';'" />
                            </TextBlock>
                            <TextBlock>
                                <Run Text="Use this chars to match any substring: &#x09;" />
                                <Run FontFamily="Courier New" Text="'|'" />
                            </TextBlock>
                        </StackPanel>
                    </ToolTip.Tip>
                </TextBox>

                <TransitioningContentControl Margin="15,0"
                                             VerticalAlignment="Center"
                                             Foreground="{DynamicResource AccentFillColorDefaultBrush}"
                                             FontSize="30"
                                             FontWeight="DemiBold"
                                             Content="{Binding SelectedIconPackNavigationItem.Title}" />
            </DockPanel>
        </Border>


        <fa:NavigationView Grid.Row="1"
                           PaneDisplayMode="Left"
                           IsPaneOpen="True"
                           OpenPaneLength="205"
                           MenuItemsSource="{Binding AvailableIconPacks}"
                           SelectedItem="{Binding SelectedIconPackNavigationItem}">
            <fa:NavigationView.MenuItemTemplateSelector>
                <helper:MenuItemTemplateSelector>
                    <helper:MenuItemTemplateSelector.ItemTemplate>
                        <DataTemplate DataType="vm:NavigationItemViewModelBase">
                            <fa:NavigationViewItem Content="{Binding Title}" IconSource="{Binding Icon}" />
                        </DataTemplate>
                    </helper:MenuItemTemplateSelector.ItemTemplate>
                    <helper:MenuItemTemplateSelector.SeparatorTemplate>
                        <DataTemplate DataType="vm:SeparatorNavigationItemViewModel">
                            <fa:NavigationViewItemSeparator />
                        </DataTemplate>
                    </helper:MenuItemTemplateSelector.SeparatorTemplate>
                </helper:MenuItemTemplateSelector>
            </fa:NavigationView.MenuItemTemplateSelector>

            <Grid ColumnDefinitions="*,Auto" >
                
                <ListBox Grid.Column="0"
                         Margin="2"
                         ItemTemplate="{StaticResource IconPacksBrowser.DataTemplates.ListBox.IconViewModel}"
                         ItemsSource="{Binding VisibleIcons}"
                         ItemContainerTheme="{StaticResource IconPackBrowserListBoxItemStyle}"
                         SelectedValue="{Binding SelectedIcon}">

                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <controls:VirtualizingWrapPanel SpacingMode="Uniform" />
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                </ListBox>

                <views:IconPreviewer Grid.Column="1"  />

            </Grid>
        </fa:NavigationView>

        <StackPanel Grid.Row="2"
                    Height="24"
                    x:DataType="vm:MainViewModel"
                    DataContext="{x:Static vm:MainViewModel.Instance}"
                    Background="{DynamicResource AccentFillColorDefaultBrush}"
                    TextElement.Foreground="White"
                    Orientation="Horizontal">

            <!--  Some Styles for the StatusBar appearance  -->
            <StackPanel.Styles>
                <Style Selector="ContentControl">
                    <Setter Property="VerticalAlignment" Value="Center" />
                    <Setter Property="Margin" Value="8,0" />
                </Style>
                
                <Style Selector="Separator">
                    <Setter Property="Width" Value="1" />
                    <Setter Property="Height" Value="10" />
                    <Setter Property="VerticalAlignment" Value="Center" />
                    <Setter Property="Background" Value="White" />
                </Style>
                
                <Style Selector="HyperlinkButton">
                    <Setter Property="VerticalAlignment" Value="Center" />
                    <Setter Property="Margin" Value="8,0" />
                    <Setter Property="Foreground" Value="White" />
                    <Setter Property="IsEnabled" Value="{Binding $self.NavigateUri, Converter={x:Static ObjectConverters.IsNotNull}}" />
                    <Style Selector="^:pointerover /template/ ContentPresenter#ContentPresenter">
                        <Setter Property="Foreground" Value="White" />
                        <Setter Property="TextBlock.TextDecorations" Value="{x:Static TextDecorations.Underline}" />
                    </Style>
                    <Style Selector="^:disabled /template/ ContentPresenter#ContentPresenter">
                        <Setter Property="Foreground" Value="White" />
                        <Setter Property="Opacity" Value="0.5" />
                    </Style>
                </Style>
            </StackPanel.Styles>

            <ContentControl Content="{Binding AppVersion, Mode=OneWay, StringFormat='{}Browser version v{0}'}" />
            <Separator />

            <ContentControl Content="{Binding SelectedIconPackNavigationItem.Tag, Converter={x:Static converters:GetAssemblyVersionConverter.Instance}, Mode=OneWay, StringFormat='{}IconPack version v{0}'}" IsVisible="{Binding SelectedIconPackNavigationItem.Tag, Converter={x:Static ObjectConverters.IsNotNull}}" />
            <Separator IsVisible="{Binding SelectedIconPackNavigationItem, Converter={x:Static ObjectConverters.IsNotNull}}" />

            <ContentControl Content="{Binding SelectedIconPackNavigationItem, Mode=OneWay}">
                <ContentControl.DataTemplates>
                    <DataTemplate DataType="{x:Type vm:IconPackNavigationItemViewModel}">
                        <TextBlock>
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0} with {1:N0} icons">
                                    <Binding Mode="OneWay" Path="Title" />
                                    <Binding Mode="OneWay" Path="IconPack.IconCount" />
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </DataTemplate>
                    <DataTemplate DataType="{x:Type vm:AllIconPacksNavigationItemViewModel}">
                        <TextBlock>
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0} with {1:N0} icons">
                                    <Binding Mode="OneWay" Path="Title" />
                                    <Binding Mode="OneWay" Path="MainViewModel.TotalItems" />
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </DataTemplate>
                </ContentControl.DataTemplates>
            </ContentControl>

            <Separator />

            <HyperlinkButton Margin="0,0,4,0"
                             VerticalAlignment="Center"
                             NavigateUri="{Binding SelectedIcon.MetaData.ProjectUrl, Mode=OneWay}">
                <Button.ContentTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconOcticons Width="14"
                                                        Height="14"
                                                        Margin="0,0,4,0"
                                                        VerticalAlignment="Center"
                                                        Kind="LinkExternal" />
                            <TextBlock VerticalAlignment="Center" Text="Project site" />
                        </StackPanel>
                    </DataTemplate>
                </Button.ContentTemplate>
                <ToolTip.Tip>
                    <TextBlock Text="{Binding SelectedIcon.MetaData.ProjectUrl, Mode=OneWay, StringFormat='{}Visit: {0}'}" />
                </ToolTip.Tip>
            </HyperlinkButton>

            <Separator />

            <HyperlinkButton Margin="0,0,4,0"
                             VerticalAlignment="Center"
                             NavigateUri="{Binding SelectedIcon.MetaData.LicenseUrl, Mode=OneWay}">
                <Button.ContentTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconOcticons Width="14"
                                                        Height="14"
                                                        Margin="0,0,4,0"
                                                        VerticalAlignment="Center"
                                                        Kind="Law" />
                            <TextBlock VerticalAlignment="Center" Text="License" />
                        </StackPanel>
                    </DataTemplate>
                </Button.ContentTemplate>
                <ToolTip.Tip>
                    <TextBlock Text="{Binding SelectedIcon.MetaData.LicenseUrl, Mode=OneWay, StringFormat='{}License: {0}'}" />
                </ToolTip.Tip>
            </HyperlinkButton>
        </StackPanel>
    </Grid>
</UserControl>